#!/bin/bash

# Verify that we're in the root directory
ROOT_FILE="`pwd`/.gitmodules";
if [ ! -f "$ROOT_FILE" ]; 
then
    echo "Error: Go to root directory"
	exit 1
fi

# Verify inputs
if [ -z "$1" ]
then
    echo "Error: Enter a package name"
    exit 1
fi

if [ -z "$2" ]
then
    echo "Error: Enter a package description"
    exit 1
fi

GITHUB_ORGANIZATION="coins"

TITLE="$1"
TITLE_SHORT="${TITLE/\-js/}"
DESCRIPTION="$2"

MY_PATH="$(dirname "$(readlink "$0")")"
TEMPLATE_PATH="$MY_PATH/src/template"

# Create Directory
if [ ! -f "$TITLE" ]; 
then
    echo "Error: Module $TITLE already exists"
	exit 1
fi

mkdir $TITLE
cd $TITLE

mkdir src
mkdir dist

# Process README Template
sed -e "s/{{title}}/$TITLE/" -e "s/{{title_short}}/$TITLE_SHORT/g" -e "s/{{description}}/$DESCRIPTION/" "$TEMPLATE_PATH/README.md" > src/README.md

# Create symlink for README 
ln -s src/README.md README.md

# Standard File
touch "src/$TITLE_SHORT.js"
cp $TEMPLATE_PATH src 



# # Initial commit
# git init
# git add -A
# git commit -m "Package initialization"

# # Create Repository in Github
# hub create $GITHUB_ORGANIZATION/$1 --description="$2"

# git push -u origin HEAD

# git push origin master

# # Go to root directory and commit the new submodule
# cd ..

# git submodule add ../$1.git $1
# git submodule init 

# git add -A
# git commit -m "Adding new package $1"
# git push

# cd $1